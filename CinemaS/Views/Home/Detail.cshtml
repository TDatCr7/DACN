@model CinemaS.Models.Movies
@{
    ViewData["Title"] = Model.Title;
    Layout = "~/Views/Shared/_Layout.cshtml";

    // ===== YouTube -> embed =====
    string? embed = null;
    if (!string.IsNullOrWhiteSpace(Model.TrailerLink))
    {
        var link = Model.TrailerLink!;
        if (link.Contains("youtu.be/"))
        {
            var id = link.Split("youtu.be/").Last().Split('?')[0];
            embed = $"https://www.youtube.com/embed/{id}";
        }
        else if (link.Contains("watch?v="))
        {
            var id = link.Split("watch?v=").Last().Split('&')[0];
            embed = $"https://www.youtube.com/embed/{id}";
        }
        else if (link.Contains("/shorts/"))
        {
            var id = link.Split("/shorts/").Last().Split('?')[0];
            embed = $"https://www.youtube.com/embed/{id}";
        }
    }

    // ===== Text fallback =====
    var ageText = Model.Age?.ToString() ?? "13";
    var genreText = (ViewBag.GenreText as string) ?? "Chưa có thông tin";
    var directorText = (ViewBag.DirectorText as string) ?? "Chưa có thông tin";
    var castText = (ViewBag.CastText as string) ?? "Chưa có thông tin";

    var durationText = Model.Duration.HasValue ? $"{Model.Duration} phút" : "Chưa có thông tin";
    var countryText = !string.IsNullOrWhiteSpace(Model.Country) ? Model.Country : "Chưa có thông tin";
    var audioText = !string.IsNullOrWhiteSpace(Model.AudioOption) ? Model.AudioOption : "Chưa có thông tin";
    var releaseText = Model.ReleaseDate.HasValue
        ? Model.ReleaseDate.Value.ToString("dd/MM/yyyy", new System.Globalization.CultureInfo("vi-VN"))
        : "Chưa có thông tin";

    var contentText = !string.IsNullOrWhiteSpace(Model.DetailDescription)
        ? Model.DetailDescription
        : (!string.IsNullOrWhiteSpace(Model.Summary) ? Model.Summary : "Chưa có thông tin");
}

<style>
    /* ===== MOVIE DETAIL (sync with layout vars) ===== */
    .md-wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 6px 0 18px;
    }

    .md-card {
        border-radius: 26px;
        border: 1px solid rgba(148,163,255,.35);
        background: radial-gradient(circle at 0 0, rgba(59,92,204,.22), transparent 55%), radial-gradient(circle at 100% 0, rgba(124,58,237,.18), transparent 55%), rgba(2,6,23,.82);
        box-shadow: 0 22px 60px rgba(15,23,42,.72), 0 0 0 1px rgba(15,23,42,.65);
        overflow: hidden;
    }

    .md-top {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 22px;
        padding: 18px;
        align-items: start;
    }

    .md-poster {
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(148,163,255,.22);
        background: rgba(15,23,42,.75);
        box-shadow: 0 18px 46px rgba(0,0,0,.35);
    }

        .md-poster img {
            width: 100%;
            height: auto;
            display: block;
            aspect-ratio: 3/4;
            object-fit: cover;
        }

    .md-title {
        margin: 0;
        font-weight: 1000;
        letter-spacing: .2px;
        font-size: 34px;
        line-height: 1.15;
        color: var(--text);
    }

    .md-divider {
        height: 1px;
        background: rgba(255,255,255,.12);
        margin: 12px 0 14px;
    }

    .md-meta {
        display: grid;
        grid-template-columns: 1fr;
        gap: 4px;
        color: var(--text);
        font-weight: 700;
        font-size: 15px;
    }

    .md-row {
        display: flex;
        gap: 10px;
        align-items: baseline;
        flex-wrap: wrap;
    }

    .md-k {
        font-weight: 900;
        color: rgba(226,232,240,.92);
        min-width: 110px;
    }

    .md-v {
        color: rgba(226,232,240,.92);
        font-weight: 800;
    }

    .md-rated {
        margin-top: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        font-weight: 900;
        letter-spacing: .25px;
        color: rgba(226,232,240,.92);
    }

    .md-badge-age {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 34px;
        padding: 0 12px;
        border-radius: 10px;
        background: #fbbf24;
        color: #111;
        font-weight: 1000;
        border: 1px solid rgba(251,191,36,.55);
        box-shadow: 0 12px 26px rgba(0,0,0,.22);
    }

    .md-format {
        margin-top: 10px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
    }

    .md-chip {
        height: 38px;
        padding: 0 14px;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(148,163,255,.35);
        background: rgba(15,23,42,.70);
        color: rgba(226,232,240,.92);
        font-weight: 1000;
        letter-spacing: .4px;
        text-transform: uppercase;
        box-shadow: 0 12px 26px rgba(0,0,0,.18);
        user-select: none;
    }

    .md-actions {
        margin-top: 14px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
    }

    .md-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        height: 42px;
        padding: 0 18px;
        border-radius: 999px;
        border: 1px solid rgba(148,163,255,.35);
        background: rgba(15,23,42,.75);
        color: var(--text);
        font-weight: 900;
        text-decoration: none;
        box-shadow: 0 16px 38px rgba(0,0,0,.22);
    }

        .md-btn:hover {
            filter: brightness(1.08);
            color: #fff;
            text-decoration: none;
        }

        .md-btn.primary {
            border: none;
            background: linear-gradient(120deg, var(--indigo), var(--purple));
        }

    /* Tabs like screenshot: “Chi tiết | Trailer” */
    .md-tabs {
        padding: 0 18px 18px;
    }

    .md-tabs-bar {
        margin: 0 auto;
        width: fit-content;
        background: rgba(15,23,42,.92);
        border: 1px solid rgba(148,163,255,.35);
        border-radius: 999px;
        padding: 6px;
        display: flex;
        gap: 6px;
        box-shadow: 0 18px 45px rgba(15,23,42,.50);
    }

    .md-tab {
        padding: 8px 14px;
        border-radius: 999px;
        color: rgba(226,232,240,.90);
        font-weight: 900;
        font-size: 13px;
        letter-spacing: .3px;
        text-decoration: none;
        position: relative;
        overflow: hidden;
        user-select: none;
    }

        .md-tab::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(239,68,68,.92), rgba(220,38,38,.92));
            transform: translateX(-110%);
            transition: transform .35s ease;
            z-index: -1;
        }

        .md-tab:hover::before {
            transform: translateX(0);
        }

        .md-tab:hover {
            color: #fff;
            text-decoration: none;
        }

    .md-section {
        margin-top: 14px;
    }

    .md-section-card {
        margin-top: 12px;
        border-radius: 22px;
        border: 1px solid rgba(148,163,255,.28);
        background: rgba(2,6,23,.70);
        box-shadow: 0 18px 55px rgba(15,23,42,.55);
        overflow: hidden;
    }

    .md-section-head {
        padding: 12px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        border-bottom: 1px solid rgba(148,163,255,.14);
        background: radial-gradient(circle at 10% 10%, rgba(59,92,204,.26), transparent 60%), radial-gradient(circle at 90% 10%, rgba(124,58,237,.22), transparent 60%), rgba(2,6,23,.88);
    }

    .md-section-title {
        margin: 0;
        font-weight: 1000;
        font-size: 14px;
        letter-spacing: .25px;
        text-transform: uppercase;
        color: rgba(226,232,240,.92);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .md-section-body {
        padding: 14px;
        color: rgba(226,232,240,.90);
        font-weight: 700;
        line-height: 1.85;
    }

    .md-desc {
        color: rgba(226,232,240,.85);
        margin: 0;
    }

    .md-video {
        padding: 14px;
    }

        .md-video iframe {
            width: 100%;
            aspect-ratio: 16/9;
            border: none;
            border-radius: 16px;
            box-shadow: 0 16px 40px rgba(0,0,0,.35);
            background: #000;
        }

    @@media (max-width: 991.98px) {
        .md-top {
            grid-template-columns: 280px 1fr;
        }
    }
    @@media (max-width: 767.98px) {
        .md-top {
            grid-template-columns: 1fr;
        }

        .md-title {
            font-size: 26px;
        }

        .md-k {
            min-width: 96px;
        }
    }
    /* Badge tuổi xanh tím */
    .md-age-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 14px;
        border-radius: 999px;
        font-weight: 900;
        font-size: 14px;
        letter-spacing: .5px;
        color: #e9ecf6;
        background: rgba(15,23,42,.85);
        border: 1.5px solid transparent;
        background-image: linear-gradient(rgba(15,23,42,.85), rgba(15,23,42,.85)), linear-gradient(120deg, #3b5ccc, #7c3aed);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        box-shadow: 0 0 0 1px rgba(124,58,237,.35), 0 8px 22px rgba(15,23,42,.6);
    }

</style>

<div class="md-wrap">

    <div class="md-card">
        <!-- ===== TOP: poster + info ===== -->
        <div class="md-top" id="detail">
            <div class="md-poster">
                <img src="@(!string.IsNullOrWhiteSpace(Model.PosterImage) ? Model.PosterImage : "/images/no-poster.png")"
                     alt="@Model.Title" />
            </div>

            <div>
                <h1 class="md-title">@Model.Title</h1>
                <div class="md-divider"></div>

                <div class="md-meta">
                    <div class="md-row"><span class="md-k">Đạo diễn:</span><span class="md-v">@directorText</span></div>
                    <div class="md-row"><span class="md-k">Diễn viên:</span><span class="md-v">@castText</span></div>
                    <div class="md-row"><span class="md-k">Thể loại:</span><span class="md-v">@genreText</span></div>
                    <div class="md-row"><span class="md-k">Khởi chiếu:</span><span class="md-v">@releaseText</span></div>
                    <div class="md-row"><span class="md-k">Thời lượng:</span><span class="md-v">@durationText</span></div>
                    <div class="md-row"><span class="md-k">Quốc gia:</span><span class="md-v">@countryText</span></div>
                    <div class="md-row"><span class="md-k">Ngôn ngữ:</span><span class="md-v">@audioText</span></div>
                </div>

                <div class="md-rated">
                    <span class="md-age-badge">@($"T{ageText}")</span>
                    <span>PHIM ĐƯỢC PHỔ BIẾN ĐẾN NGƯỜI XEM TỪ ĐỦ @ageText TUỔI TRỞ LÊN (@ageText+)</span>
                </div>

                <!-- Format chips (tĩnh để giống ảnh; nếu có dữ liệu thật thì tự map lại) -->
                <div class="md-format" aria-label="Định dạng">
                    <span class="md-chip">2D</span>
                    <span class="md-chip">3D</span>
                    <span class="md-chip">4DX</span>
                    <span class="md-chip">IMAX</span>
                    <span class="md-chip">SCREENX</span>
                    <span class="md-chip">STARIUM</span>
                </div>

                <div class="md-actions">
                    <a asp-controller="Booking"
                       asp-action="Create"
                       asp-route-movieId="@Model.MoviesId"
                       class="md-btn primary">
                        <i class="fa-solid fa-ticket"></i> MUA VÉ
                    </a>
                </div>
            </div>
        </div>

        <!-- ===== Tabs like screenshot ===== -->
        <div class="md-tabs">
            <div class="md-tabs-bar">
                <a class="md-tab" href="#detail"><i class="fa-solid fa-circle-info me-1"></i> Nội dung phim</a>
                <a class="md-tab" href="#trailer"><i class="fa-solid fa-film me-1"></i> Trailer</a>
            </div>

            <!-- ===== Detail content ===== -->
            <div class="md-section">
                <div class="md-section-card">
                    <div class="md-section-head">
                        <h3 class="md-section-title">
                            <i class="fa-solid fa-align-left"></i> Nội dung
                        </h3>
                    </div>
                    <div class="md-section-body">
                        <p class="md-desc">@Html.Raw(contentText)</p>
                    </div>
                </div>
            </div>

            <!-- ===== Trailer ===== -->
            <div class="md-section" id="trailer">
                <div class="md-section-card">
                    <div class="md-section-head">
                        <h3 class="md-section-title">
                            <i class="fa-solid fa-video"></i> Trailer
                        </h3>
                    </div>

                    <div class="md-video">
                        @if (embed != null)
                        {
                            <iframe src="@embed"
                                    title="Trailer @Model.Title"
                                    allowfullscreen
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                            </iframe>
                        }
                        else
                        {
                            <div class="md-section-body">
                                Chưa có trailer.
                            </div>
                        }
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        // smooth scroll for #detail / #trailer
        document.querySelectorAll('a[href^="#"]').forEach(a => {
            a.addEventListener('click', (e) => {
                const id = a.getAttribute('href');
                if (!id || id.length < 2) return;
                const el = document.querySelector(id);
                if (!el) return;
                e.preventDefault();
                el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
}
