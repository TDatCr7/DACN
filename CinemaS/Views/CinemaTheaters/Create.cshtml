@model CinemaS.Models.CinemaTheaters
@{
	ViewData["Title"] = "Tạo phòng chiếu mới";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="container mt-4">
	<div class="row justify-content-center">
		<div class="col-md-8">
			<div class="card shadow">
				<div class="card-header bg-primary text-white">
					<h3><i class="fas fa-door-open"></i> Tạo phòng chiếu mới</h3>
				</div>
				<div class="card-body">
					<!-- Thông báo lỗi từ server -->
					@if (TempData["Error"] != null)
					{
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<i class="fas fa-exclamation-circle"></i> <strong>Lỗi:</strong> @TempData["Error"]
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					}

					<form asp-action="Create" method="post" id="createForm" novalidate>
						<div class="mb-3">
							<label class="form-label"><i class="fas fa-tag"></i> Tên phòng <span class="text-danger">*</span></label>
							<input asp-for="Name" class="form-control" placeholder="VD: Phòng 1, Phòng VIP A..." />
							<div class="invalid-feedback d-block" id="nameError"></div>
							<span asp-validation-for="Name" class="text-danger"></span>
						</div>

						<div class="mb-3">
							<label class="form-label"><i class="fas fa-tv"></i> Loại phòng <span class="text-danger">*</span></label>
							<select asp-for="CinemaTypeId" class="form-select" id="cinemaTypeSelect">
								<option value="">-- Chọn loại phòng --</option>
								@if (ViewBag.CinemaTypes != null)
								{
									@foreach (var item in ViewBag.CinemaTypes)
									{
										<option value="@item.Value">@item.Text</option>
									}
								}
							</select>
							<div class="invalid-feedback d-block" id="cinemaTypeError"></div>
							<span asp-validation-for="CinemaTypeId" class="text-danger"></span>
						</div>

						<div class="mb-3">
							<label class="form-label"><i class="fas fa-building"></i> Rạp chiếu <span class="text-danger">*</span></label>
							<select asp-for="MovieTheaterId" class="form-select" id="movieTheaterSelect">
								<option value="">-- Chọn rạp --</option>
								@if (ViewBag.MovieTheaters != null)
								{
									@foreach (var item in ViewBag.MovieTheaters)
									{
										<option value="@item.Value">@item.Text</option>
									}
								}
							</select>
							<div class="invalid-feedback d-block" id="movieTheaterError"></div>
							<span asp-validation-for="MovieTheaterId" class="text-danger"></span>
						</div>


						<div class="d-flex gap-2">
							<button type="submit" class="btn btn-success" id="submitBtn">
								<i class="fas fa-save"></i> Tạo phòng và ghế
							</button>
							<a asp-action="Index" class="btn btn-secondary">
								<i class="fas fa-arrow-left"></i> Quay lại
							</a>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const form = document.getElementById('createForm');
			const nameInput = document.getElementById('Name');
			const cinemaTypeSelect = document.getElementById('cinemaTypeSelect');
			const movieTheaterSelect = document.getElementById('movieTheaterSelect');
			const submitBtn = document.getElementById('submitBtn');

			// Kiểm tra validation trước khi submit
			form.addEventListener('submit', function (e) {
				let isValid = true;
				let errors = [];

				// Kiểm tra tên phòng
				if (!nameInput.value.trim()) {
					isValid = false;
					errors.push('Tên phòng không được để trống');
					document.getElementById('nameError').innerHTML = '<i class="fas fa-times-circle"></i> Tên phòng không được để trống';
					nameInput.classList.add('is-invalid');
				} else if (nameInput.value.trim().length < 3) {
					isValid = false;
					errors.push('Tên phòng phải có ít nhất 3 ký tự');
					document.getElementById('nameError').innerHTML = '<i class="fas fa-times-circle"></i> Tên phòng phải có ít nhất 3 ký tự';
					nameInput.classList.add('is-invalid');
				} else {
					document.getElementById('nameError').innerHTML = '';
					nameInput.classList.remove('is-invalid');
				}

				// Kiểm tra loại phòng
				if (!cinemaTypeSelect.value) {
					isValid = false;
					errors.push('Vui lòng chọn loại phòng');
					document.getElementById('cinemaTypeError').innerHTML = '<i class="fas fa-times-circle"></i> Vui lòng chọn loại phòng';
					cinemaTypeSelect.classList.add('is-invalid');
				} else {
					document.getElementById('cinemaTypeError').innerHTML = '';
					cinemaTypeSelect.classList.remove('is-invalid');
				}

				// Kiểm tra rạp chiếu
				if (!movieTheaterSelect.value) {
					isValid = false;
					errors.push('Vui lòng chọn rạp chiếu');
					document.getElementById('movieTheaterError').innerHTML = '<i class="fas fa-times-circle"></i> Vui lòng chọn rạp chiếu';
					movieTheaterSelect.classList.add('is-invalid');
				} else {
					document.getElementById('movieTheaterError').innerHTML = '';
					movieTheaterSelect.classList.remove('is-invalid');
				}

				// Nếu không hợp lệ, không submit
				if (!isValid) {
					e.preventDefault();

					// Hiển thị alert
					let errorMessage = '⚠️ Vui lòng kiểm tra lại:\n\n';
					errors.forEach(error => {
						errorMessage += '• ' + error + '\n';
					});
					alert(errorMessage);
				}
			});

			// Xóa lỗi khi người dùng điền lại
			nameInput.addEventListener('input', function () {
				if (this.value.trim().length >= 3) {
					document.getElementById('nameError').innerHTML = '';
					this.classList.remove('is-invalid');
				}
			});

			cinemaTypeSelect.addEventListener('change', function () {
				if (this.value) {
					document.getElementById('cinemaTypeError').innerHTML = '';
					this.classList.remove('is-invalid');
				}
			});

			movieTheaterSelect.addEventListener('change', function () {
				if (this.value) {
					document.getElementById('movieTheaterError').innerHTML = '';
					this.classList.remove('is-invalid');
				}
			});
		});
	</script>

	<style>
		.invalid-feedback {
			color: #dc3545;
			font-size: 0.875rem;
			margin-top: 0.25rem;
		}

		.is-invalid {
			border-color: #dc3545 !important;
			background-color: #fff8f8;
		}

		.form-control:focus.is-invalid,
		.form-select:focus.is-invalid {
			border-color: #dc3545 !important;
			box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
		}
	</style>
}
