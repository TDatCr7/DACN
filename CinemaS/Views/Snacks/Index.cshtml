@model IEnumerable<CinemaS.Models.Snacks>

@{
	ViewData["Title"] = "Quản lý Đồ Ăn";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/management.css" />
<link rel="stylesheet" href="~/css/Snacks.css" />

<div class="container-fluid mt-4">
	<!-- Header -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="fw-bold">
			<i class="fas fa-utensils"></i> Quản lý Đồ Ăn
		</h1>
		<div class="d-flex gap-2">
			<a asp-action="Create" class="btn btn-primary btn-sweep px-3" style="border-radius:999px; padding:9px 20px; font-size:14px; font-weight:700; white-space:nowrap;">
				<i class="fa-solid fa-plus me-1"></i> Tạo mới
			</a>
			<a asp-controller="Admin" asp-action="Index" class="btn btn-outline-light-rounded btn-sweep px-3" style="border-radius:999px; padding:9px 20px; font-size:14px; font-weight:700; white-space:nowrap;">
				<i class="fa-solid fa-arrow-left"></i> Quay lại
			</a>
		</div>
	</div>

	<!-- Alerts -->
	@if (TempData["Message"] != null)
	{
		<div class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="fas fa-check-circle"></i> @TempData["Message"]
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	}
	@if (TempData["Warning"] != null)
	{
		<div class="alert alert-warning alert-dismissible fade show" role="alert">
			<i class="fas fa-exclamation-triangle"></i> @TempData["Warning"]
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	}
	@if (TempData["Error"] != null)
	{
		<div class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="fas fa-times-circle"></i> @TempData["Error"]
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	}

	<!-- Search -->
		<div class="admin-toolbar">
            <form method="get"
                  class="admin-search-shell d-flex gap-2 align-items-center"
                  id="adminFilterForm">

                <div class="input-group admin-search-compact">
                    <input type="text"
                           name="searchString"
                           class="form-control admin-search-input"
                           placeholder="Tìm theo tên, mã hoặc mô tả..."
                           value="@ViewData["CurrentFilter"]" />
                    <button class="admin-search-btn" type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

            </form>
        </div>

	<!-- Table - sử dụng admin-table-wrap và admin-table -->
	<div class="admin-table-wrap">
		<table class="table admin-table align-middle">
			<thead>
				<tr>
					<th><i class="fa-solid fa-hashtag"></i>STT</th>
					<th><i class="fa-solid fa-image"></i>Ảnh</th>
					<th><i class="fa-solid fa-tag"></i>Mã</th>
					<th><i class="fa-solid fa-utensils"></i>Tên</th>
					<th><i class="fa-solid fa-money-bill"></i>Giá (VNĐ)</th>
					<th><i class="fa-solid fa-align-left"></i>Mô tả</th>
					<th><i class="fa-solid fa-toggle-on"></i>Trạng thái</th>
					<th style="text-align:right;"><i class="fa-solid fa-ellipsis-vertical"></i>Hành động</th>
				</tr>
			</thead>
			<tbody>
				@if (Model != null && Model.Any())
				{
					int index = 1;
					foreach (var item in Model)
					{
						<tr>
							<td class="text-center fw-bold">@index</td>
							<td class="text-center">
								<img src="@(string.IsNullOrEmpty(item.Image) ? "/images/snacks/default-snack.png" : item.Image)"
									 alt="@item.Name" class="rounded snack-image shadow-sm" />
							</td>
							<td><strong>@item.SnackId</strong></td>
							<td>@item.Name</td>
							<td class="text-end fw-semibold" style="color: #fbbf24;">
								@(item.Price.HasValue ? item.Price.Value.ToString("N0") : "Chưa định giá")
							</td>
							<td class="admin-text-muted">
								@(string.IsNullOrEmpty(item.Description)
									? "Không có mô tả"
									: (item.Description.Length > 50
										? item.Description.Substring(0, 50) + "..."
										: item.Description))
							</td>
							<td>
								@if (item.IsActive == true)
								{
									<span class="badge-email-ok"><i class="fas fa-check"></i> Đang bán</span>
								}
								else
								{
									<span class="badge-email-no"><i class="fas fa-ban"></i> Ngừng bán</span>
								}
							</td>
							<td class="text-end">
								<a asp-action="Edit" asp-route-id="@item.SnackId" 
								   class="admin-icon-btn" title="Chỉnh sửa">
									<i class="fa-solid fa-pen"></i>
								</a>
								<a asp-action="Delete" asp-route-id="@item.SnackId" 
								   class="admin-icon-btn admin-icon-btn-danger" title="Xóa">
									<i class="fa-solid fa-trash-can"></i>
								</a>
							</td>
						</tr>
						index++;
					}
				}
				else
				{
					<tr>
						<td colspan="8" class="text-center admin-text-muted py-4">
							<i class="fas fa-inbox fa-3x mb-3 d-block"></i>
							<strong>Không tìm thấy đồ ăn nào</strong>
							@if (!string.IsNullOrEmpty(ViewData["CurrentFilter"]?.ToString()))
							{
								<p class="mb-0">với từ khóa "<strong>@ViewData["CurrentFilter"]</strong>"</p>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

@section Scripts {
	<script>
		// Tự ẩn thông báo sau 5s
		setTimeout(() => document.querySelectorAll('.alert').forEach(a => a.style.display = 'none'), 5000);
	</script>
}
