@model IEnumerable<CinemaS.Models.CinemaTypes>

@{
    ViewData["Title"] = "Quản lý Loại Phòng Chiếu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .search-container {
        margin-bottom: 20px;
display: flex;
 justify-content: space-between;
    align-items: center;
        gap: 15px;
    }

    .search-box {
        flex: 1;
        max-width: 400px;
    }

    .table-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
padding: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

    .table {
        color: #e9ecf6;
    }

    .table thead {
     background: linear-gradient(90deg, var(--indigo) 0%, var(--purple) 100%);
        color: white;
    }

  .table tbody tr {
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
   transition: all 0.3s ease;
    }

    .table tbody tr:hover {
        background: rgba(124, 58, 237, 0.15);
 transform: translateX(5px);
    }

    .btn-action {
        margin: 0 2px;
        padding: 5px 12px;
        font-size: 14px;
  }

    .alert {
        border-radius: 8px;
        animation: slideIn 0.3s ease;
    }

    @@keyframes slideIn {
        from {
          opacity: 0;
      transform: translateY(-10px);
        }
      to {
 opacity: 1;
            transform: translateY(0);
        }
    }

    .no-results {
        text-align: center;
     padding: 40px;
        color: #9aa5c6;
        font-style: italic;
    }
</style>

<h1 class="mb-4">
    <i class="fa-solid fa-film"></i> Quản lý Loại Phòng Chiếu
</h1>

@* TempData Messages *@
@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-check-circle"></i> @TempData["Message"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Warning"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-exclamation-triangle"></i> @TempData["Warning"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-exclamation-circle"></i> @TempData["Error"]
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
}

<div class="search-container">
    <div class="search-box">
        <div class="input-group">
     <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo tên hoặc mã..." />
    <button class="btn btn-primary" type="button" onclick="searchCinemaTypes()">
         <i class="fa-solid fa-search"></i> Tìm kiếm
            </button>
      </div>
    </div>
    <a asp-action="Create" class="btn btn-success">
        <i class="fa-solid fa-plus-circle"></i> Tạo mới
    </a>
</div>

<div class="table-container">
    <table class="table table-hover" id="cinemaTypesTable">
    <thead>
            <tr>
        <th>Mã loại</th>
     <th>Tên loại phòng</th>
            <th>Mô tả</th>
     <th>Code</th>
        <th style="width: 200px;">Hành động</th>
            </tr>
        </thead>
  <tbody id="tableBody">
       @if (Model.Any())
     {
            @foreach (var item in Model)
     {
            <tr>
             <td>@item.CinemaTypeId</td>
            <td>@item.Name</td>
               <td>@item.Description</td>
          <td>@item.Code</td>
    <td>
       <a asp-action="Edit" asp-route-id="@item.CinemaTypeId" class="btn btn-warning btn-sm btn-action">
          <i class="fa-solid fa-edit"></i> Sửa
  </a>
 <a asp-action="Details" asp-route-id="@item.CinemaTypeId" class="btn btn-info btn-sm btn-action">
             <i class="fa-solid fa-eye"></i> Chi tiết
      </a>
   <button onclick="confirmDelete('@item.CinemaTypeId', '@item.Name')" class="btn btn-danger btn-sm btn-action">
            <i class="fa-solid fa-trash"></i> Xóa
      </button>
              </td>
         </tr>
        }
    }
         else
     {
                <tr>
    <td colspan="5" class="no-results">
            <i class="fa-solid fa-inbox"></i> Chưa có dữ liệu
              </td>
        </tr>
}
        </tbody>
    </table>
</div>

<!-- Delete Confirmation Form (Hidden) -->
<form id="deleteForm" method="post" style="display: none;">
    @Html.AntiForgeryToken()
    <input type="hidden" id="deleteId" name="id" />
</form>

    <script>
        // AJAX Search
        function searchCinemaTypes() {
   const searchString = document.getElementById('searchInput').value.trim();
        
            fetch(`/CinemaTypes/SearchCinemaTypes?searchString=${encodeURIComponent(searchString)}`)
       .then(response => response.json())
         .then(data => {
           const tbody = document.getElementById('tableBody');
 tbody.innerHTML = '';

       if (data.length === 0) {
              tbody.innerHTML = `<tr><td colspan="5" class="no-results"><i class="fa-solid fa-inbox"></i> Không tìm thấy kết quả</td></tr>`;
  } else {
              data.forEach(item => {
     tbody.innerHTML += `
       <tr>
   <td>${item.cinemaTypeId}</td>
   <td>${item.name || ''}</td>
       <td>${item.description || ''}</td>
   <td>${item.code || ''}</td>
         <td>
 <a href="/CinemaTypes/Edit/${item.cinemaTypeId}" class="btn btn-warning btn-sm btn-action">
            <i class="fa-solid fa-edit"></i> Sửa
       </a>
            <a href="/CinemaTypes/Details/${item.cinemaTypeId}" class="btn btn-info btn-sm btn-action">
            <i class="fa-solid fa-eye"></i> Chi tiết
       </a>
  <button onclick="confirmDelete('${item.cinemaTypeId}', '${item.name}')" class="btn btn-danger btn-sm btn-action">
  <i class="fa-solid fa-trash"></i> Xóa
            </button>
         </td>
        </tr>
       `;
         });
  }
         })
        .catch(error => {
      console.error('Search error:', error);
           alert('Lỗi khi tìm kiếm!');
    });
        }

     // Search on Enter key
    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
     searchCinemaTypes();
      }
        });

        // Delete confirmation with popup
        function confirmDelete(id, name) {
            if (confirm(`❌ Bạn có chắc chắn muốn xóa loại phòng "${name}" không?`)) {
       document.getElementById('deleteId').value = id;
       document.getElementById('deleteForm').action = '/CinemaTypes/Delete/' + id;
     document.getElementById('deleteForm').submit();
            }
        }

        // Auto-hide alerts after 5 seconds
      setTimeout(() => {
         document.querySelectorAll('.alert').forEach(alert => {
                alert.style.transition = 'opacity 0.5s ease';
             alert.style.opacity = '0';
 setTimeout(() => alert.remove(), 500);
      });
        }, 5000);
    </script>
