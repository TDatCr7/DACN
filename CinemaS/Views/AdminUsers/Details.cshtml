@model CinemaS.ViewModels.AdminUsers.AdminUserEditVm
@using System.Linq
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger" style="border-radius:14px;">
        @TempData["Error"]
    </div>
}
@{
    Layout = "_Layout";
    ViewData["Title"] = "Thông tin tài khoản";

    var displayName = !string.IsNullOrWhiteSpace(Model.FullName)
    ? Model.FullName.Trim()
    : (!string.IsNullOrWhiteSpace(Model.Email) && Model.Email.Contains("@")
        ? Model.Email.Split('@')[0]
        : "User");

    var isAdmin = Model.SelectedRoles != null &&
          Model.SelectedRoles.Any(r => string.Equals(r, "Admin", StringComparison.OrdinalIgnoreCase));

    var accountTypeText = isAdmin ? "Tài khoản siêu cấp" : "Tài khoản người thường";

    var emailText = string.IsNullOrWhiteSpace(Model.Email) ? "N/A" : Model.Email;

    var phoneText = string.IsNullOrWhiteSpace(Model.PhoneNumber) ? "N/A" : Model.PhoneNumber;
    var addressText = string.IsNullOrWhiteSpace(Model.Address) ? "N/A" : Model.Address;

    string genderText = !Model.Gender.HasValue
        ? "N/A"
        : (Model.Gender.Value == 1 ? "Nam"
            : Model.Gender.Value == 2 ? "Nữ"
            : Model.Gender.Value == 3 ? "Khác"
            : (Model.Gender.Value == 0 ? "N/A" : "N/A"));

    var dobText = Model.DateOfBirth.HasValue ? Model.DateOfBirth.Value.ToString("dd/MM/yyyy") : "N/A";
    var ageFromBirthText = Model.AgeFromBirth.HasValue ? $"{Model.AgeFromBirth} tuổi" : "N/A";
    var ageFieldText = Model.Age.HasValue ? $"{Model.Age}" : "N/A";

    var defaultAvatar = Url.Content("~/images/no-avatar.png");

    string avatarResolved;
    if (string.IsNullOrWhiteSpace(Model.AvatarPath))
    {
        avatarResolved = defaultAvatar;
    }
    else
    {
        var p = Model.AvatarPath.Trim();

        if (p.StartsWith("http://") || p.StartsWith("https://"))
        {
            avatarResolved = p;
        }
        else
        {
            p = p.StartsWith("/") ? p : "/" + p;
            avatarResolved = Url.Content("~" + p);
        }
    }
}

<style>
    .au-shell {
        max-width: 980px;
        margin: 16px auto 46px;
    }

    .au-island {
        position: sticky;
        top: 10px;
        z-index: 10;
        border-radius: 999px;
        padding: 10px 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        background: radial-gradient(circle at 0 0, rgba(59,130,246,.25), transparent 60%), radial-gradient(circle at 100% 0, rgba(124,58,237,.22), transparent 60%), rgba(2,6,23,.88);
        border: 1px solid rgba(148,163,255,.35);
        box-shadow: 0 18px 55px rgba(15,23,42,.92), 0 0 0 1px rgba(15,23,42,.75);
        backdrop-filter: blur(22px);
        -webkit-backdrop-filter: blur(22px);
    }

    .au-island-left {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
    }

    .au-mini-avatar {
        width: 36px;
        height: 36px;
        border-radius: 14px;
        object-fit: cover;
        border: 1px solid rgba(148,163,255,.22);
        box-shadow: 0 14px 30px rgba(0,0,0,.35);
        background: rgba(15,23,42,.75);
        flex: 0 0 auto;
    }

    .au-island-title {
        min-width: 0;
        display: flex;
        flex-direction: column;
        line-height: 1.15;
    }

        .au-island-title strong {
            font-size: 13px;
            font-weight: 900;
            letter-spacing: .25px;
            color: #e9ecf6;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 360px;
        }

        .au-island-title span {
            font-size: 12px;
            font-weight: 800;
            color: rgba(165,180,252,.95);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 360px;
        }

    .au-island-right {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 0 0 auto;
    }

    .au-pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 36px;
        padding: 0 14px;
        border-radius: 999px;
        text-decoration: none;
        font-weight: 900;
        font-size: 13px;
        border: 1px solid rgba(148,163,255,.22);
        background: rgba(15,23,42,.78);
        color: #e5e7f5;
        box-shadow: 0 14px 30px rgba(0,0,0,.25);
        white-space: nowrap;
    }

        .au-pill:hover {
            filter: brightness(1.06);
            color: #fff;
            text-decoration: none;
        }

        .au-pill.primary {
            border-color: transparent;
            background: linear-gradient(120deg, rgba(59,92,204,.95), rgba(124,58,237,.95));
            color: #fff;
        }

        .au-pill.danger {
            background: rgba(239,68,68,.10);
            border: 1px solid rgba(239,68,68,.45);
            color: #fecaca;
        }

    .au-card {
        margin-top: 14px;
        border-radius: 28px;
        overflow: hidden;
        border: 1px solid rgba(148,163,255,.30);
        background: radial-gradient(circle at 0 0, rgba(59,130,246,.22), transparent 55%), radial-gradient(circle at 100% 0, rgba(124,58,237,.18), transparent 55%), rgba(2,6,23,.92);
        box-shadow: 0 24px 70px rgba(15,23,42,.92), 0 0 0 1px rgba(15,23,42,.72);
    }

    .au-hero {
        padding: 18px 18px 14px;
        border-bottom: 1px solid rgba(148,163,255,.14);
        display: grid;
        grid-template-columns: 92px 1fr;
        gap: 14px;
        align-items: center;
    }

    .au-avatar {
        width: 92px;
        height: 92px;
        border-radius: 26px;
        object-fit: cover;
        border: 1px solid rgba(148,163,255,.22);
        background: rgba(15,23,42,.75);
        box-shadow: 0 22px 55px rgba(0,0,0,.45);
    }

    .au-hero-main {
        min-width: 0;
    }

    .au-name {
        font-size: 22px;
        font-weight: 1000;
        letter-spacing: .3px;
        margin: 0;
        color: #e9ecf6;
        line-height: 1.2;
        word-break: break-word;
    }

    .au-sub {
        margin-top: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        color: #cbd5e1;
        font-weight: 800;
        font-size: 13px;
    }

    .au-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 7px 11px;
        border-radius: 999px;
        border: 1px solid rgba(148,163,255,.18);
        background: rgba(15,23,42,.55);
        color: #e5e7eb;
        font-size: 12px;
        font-weight: 900;
        box-shadow: 0 12px 26px rgba(0,0,0,.25);
    }

        .au-chip i {
            color: rgba(148,163,255,.95);
        }

        .au-chip.ok {
            border-color: rgba(34,197,94,.30);
            background: rgba(34,197,94,.10);
            color: #bbf7d0;
        }

        .au-chip.no {
            border-color: rgba(148,163,184,.30);
            background: rgba(148,163,184,.10);
            color: #e5e7eb;
        }

        .au-chip.role {
            border-color: rgba(59,130,246,.22);
            background: rgba(59,130,246,.12);
            color: #bfdbfe;
        }

    .au-body {
        padding: 16px 18px 18px;
    }

    .au-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .au-block {
        border-radius: 20px;
        border: 1px solid rgba(148,163,255,.18);
        background: radial-gradient(circle at 0 0, rgba(15,23,42,1), rgba(15,23,42,.92));
        padding: 14px 14px;
        min-width: 0;
    }

    .au-label {
        font-size: 12px;
        font-weight: 900;
        letter-spacing: .10em;
        text-transform: uppercase;
        color: rgba(156,163,199,.95);
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

        .au-label i {
            color: rgba(148,163,255,.95);
            width: 16px;
            text-align: center;
        }

    .au-value {
        font-size: 14px;
        font-weight: 800;
        color: #f9fafb;
        word-break: break-word;
    }

        .au-value.muted {
            color: #9aa5c6;
            font-weight: 800;
        }

    .au-wide {
        grid-column: 1 / -1;
    }

    .au-footer-actions {
        padding: 14px 18px 18px;
        border-top: 1px solid rgba(148,163,255,.14);
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
    }

    @@media (max-width: 767.98px) {
        .au-grid {
            grid-template-columns: 1fr;
        }

        .au-hero {
            grid-template-columns: 1fr;
        }

        .au-avatar {
            width: 100%;
            height: 220px;
            border-radius: 22px;
        }

        .au-island-title strong, .au-island-title span {
            max-width: 180px;
        }

        .au-footer-actions {
            flex-direction: column;
            align-items: stretch;
        }

        .au-island {
            top: 8px;
        }
    }
</style>

<div class="au-shell">

    <div class="au-island">
        <div class="au-island-left">
            <img class="au-mini-avatar"
                 src="@avatarResolved"
                 alt="Avatar"
                 onerror="this.onerror=null;this.src='@defaultAvatar';" />
            <div class="au-island-title">
                <strong>@accountTypeText</strong>
                <span>@(isAdmin ? "Admin" : "User")</span>
            </div>
        </div>

        <div class="au-island-right">
            <a asp-action="Index" class="au-pill">
                <i class="fa-solid fa-arrow-left-long"></i> Quay lại
            </a>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="au-pill primary">
                <i class="fa-solid fa-pen"></i> Sửa
            </a>
        </div>
    </div>

    <div class="au-card">
        <div class="au-hero">
            <img class="au-avatar"
                 src="@avatarResolved"
                 alt="Avatar"
                 onerror="this.onerror=null;this.src='@defaultAvatar';" />

            <div class="au-hero-main">
                <h1 class="au-name">@displayName</h1>

                <div class="au-sub">
                    @if (Model.EmailConfirmed)
                    {
                        <span class="au-chip ok"><i class="fa-solid fa-badge-check"></i> Email đã xác thực</span>
                    }
                    else
                    {
                        <span class="au-chip no"><i class="fa-regular fa-circle"></i> Email chưa xác thực</span>
                    }

                    <span class="au-chip role">
                        <i class="fa-solid fa-shield-halved"></i> @(isAdmin ? "Tài khoản siêu cấp" : "Tài khoản người thường")
                    </span>
                </div>
            </div>
        </div>

        <div class="au-body">
            <div class="au-grid">
                <div class="au-block">
                    <div class="au-label"><i class="fa-regular fa-user"></i> Username</div>
                    <div class="au-value">@((string.IsNullOrWhiteSpace(Model.UserName)) ? "N/A" : Model.UserName)</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-regular fa-envelope"></i> Email</div>
                    <div class="au-value">@emailText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-solid fa-phone"></i> Điện thoại</div>
                    <div class="au-value">@phoneText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-solid fa-location-dot"></i> Địa chỉ</div>
                    <div class="au-value">@addressText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-regular fa-calendar"></i> Ngày sinh</div>
                    <div class="au-value">@dobText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-solid fa-cake-candles"></i> Tuổi (từ ngày sinh)</div>
                    <div class="au-value">@ageFromBirthText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-solid fa-hashtag"></i> Tuổi (field)</div>
                    <div class="au-value">@ageFieldText</div>
                </div>

                <div class="au-block">
                    <div class="au-label"><i class="fa-solid fa-venus-mars"></i> Giới tính</div>
                    <div class="au-value">@genderText</div>
                </div>

                <div class="au-block au-wide">
                    <div class="au-label"><i class="fa-solid fa-coins"></i> Điểm thưởng</div>
                    <div class="au-value">@Model.SavePoint</div>
                </div>
            </div>
        </div>

        <div class="au-footer-actions">
            <a asp-action="Index" class="au-pill">
                <i class="fa-solid fa-arrow-left-long"></i> Quay lại
            </a>

            <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="m-0">
                @Html.AntiForgeryToken()
                <button type="submit" class="au-pill danger" onclick="return confirm('Xoá tài khoản này?');">
                    <i class="fa-solid fa-trash-can"></i> Xoá
                </button>
            </form>
        </div>
    </div>
</div>
